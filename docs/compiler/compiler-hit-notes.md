# 编译原理（哈工大）笔记

讲师陈鄞。

## 1 [什么是编译](https://www.bilibili.com/video/BV1zW411t7YE?p=1)

计算机程序设计语言分为三个层次：

```
高级语言（High Level Language）
汇编语言（Assembly Language）
机器语言（Machine Language）
```

**机器语言**可被计算机直接理解，但与人类习惯相去甚远；**汇编语言**引入助记符（如：`MOV X, 2`）；**高级语言**类似于数学定义或自然语言的简洁形式。

编译是一种翻译的过程，它是将高级语言（源语言）翻译成汇编语言或机器语言（目标语言）的过程。

![编译过程](./img/hit0.png)

编译器在语言处理系统中的位置

```
源程序
[预处理器（Preprocessor）]
经过预处理的源程序
[编译器]
汇编语言程序
[汇编器（Assembler）]
可重定位的机器代码
[链接器（Linker）/加载器（Loader）]
目标机器代码
```

![编译器的位置](./img/hit1.png)

**预处理器**负责把存储在不同文件中的源程序聚合在一起；并且把被称作**宏**的缩写语句转换为原始语句。

**可重定位**（Relocatable）是指在内存中存放的起始位置 L 不是固定的。

> 起始位置 + 相对地址 = 绝对地址

**加载器**可以修改可重定位地址；将修改后的指令和数据放到内存中适当的位置。

**链接器**可以将多个可重定位的机器代码文件（包括库文件）链接到一起；还可以解决外部内存地址问题。

## 2 [编译系统的结构](https://www.bilibili.com/video/BV1zW411t7YE?p=2)

人工英汉翻译的例子：

```
In the room, he broke a window with a hammer.
```

```mermaid
graph BT
C[词法分析 Lexical Analysis] --> B[语法分析 Syntax Analysis]
B --> A[语义分析 Semantic Analysis]

```

通过词法分析确定句子中各个单词的词性，通过语法识别句子中的各类短语，从而获得句子的结构，接下来进行语义分析，确定各个名词成分与核心谓语动词的语义关系，最后给出**中间表示形式**。

编译器的结构：

```mermaid
graph TB
字符流 --> A[词法分析器]
A -->|词法单元流| B[语法分析器]
B -->|语法树| C[语义分析器]
C -->|语法树| D[中间代码生成器]
D -->|中间表示形式| E[机器无关代码优化器]
E -->|中间表示形式| F[目标代码生成器]
F -->|目标机器语言| G[机器相关代码优化器]
G --> H[目标机器语言]
```

其中，**分析部分**（前端）与源语言相关，包括词法分析器、语法分析器、语义分析器和中间代码生成器。

**综合部分**（后端）与目标语言相关，包括目标代码生成器和机器相关代码优化器。

什么是语法制导翻译（Syntax Directed Translation）？

在语法分析，分析句子结构的同时，结合语义规则，直接进行语义分析，这一技术称为语法制导翻译。

## 3 [词法分析概述](https://www.bilibili.com/video/BV1zW411t7YE?p=3)

词法分析是编译的第一个阶段。它的主要任务是从左向右逐行扫描源程序的字符，识别出各个单词，确定单词的类型，将识别出的单词转换成统一的**机内表示** --- 词法单元（token）形式。

```
token: < 种别码, 属性值 >
```

程序语言的单词类型，可以分为如下5类：

|  | 单词类型 | 种别 | 种别码 |
| --- | --- | --- | --- |
| 1 | 关键字 | program, if, else, then, ... |   一词一码 |
| 2 | 标识符 | 变量名，数组名，记录名，...|         多词一码 |
| 3 | 常量   | 整型、浮点型、字符型... |           一型一码 |
| 4 | 运算符 | 算术（+ - * / ++ --）<br> 关系（> < == != >= <=）<br>逻辑（& \| !）| 一词一码 |
| 5 | 界限符 | ; ( ) = { } |                    一词一码 |

例：词法分析后得到的 token 序列

输入：`while(value!=100){num++;}`

输出：

```
1 while     < WHILE ,   -   >
2 (         <  SLP  ,   -   >
3 value     <  IDN  , value >
4 !=        <   NE  ,   -   >
5 100       < CONST ,   -   >
6 )         <  SRP  ,   -   >
7 {         <   LP  ,   -   >
8 num       <  IDN  ,  num  >
9 ++        <  INC  ,   -   >
10 ;        <  SEMI ,   -   >
11 }        <   RP  ,   -   >
```

种别码应该用整型表示，这里使用了宏定义的形式，更直观。

## 4 [语法分析概述](https://www.bilibili.com/video/BV1zW411t7YE?p=4)

**语法分析器**（parser）从词法分析器输出的 token 序列中识别出各类短语，并构造**语法分析树**（parse tree）。

例1：赋值语句的分析树

```c
position = initial + rate * 60;
```

token 序列：

```
position    < id, position >
=           < = >
initial     < id, initial >
+           < + >
rate        < id, rate >
*           < * >
60          < num, 60 >
;           < ; >
```

> 本节视频 01:06 处，有赋值语句分析树的图形。

例2:变量声明语句的分析树

文法：

```
<D> -> <T> <IDS>;
<T> -> int | real | char | bool
<IDS> -> id | <IDS>, id
```

其中：

1. `D` 表示声明语句 Declaration
1. `T` 表示类型 Type
1. `IDS` 表示标识符序列 Identifier Sequence
1. `|` 表示「或」关系

如果输入 `int a, b, c;` 则它的分析树在本节视频 02:57 处。

如何根据语法规则为输入句子构造语法树？

## 5 [语义分析概述](https://www.bilibili.com/video/BV1zW411t7YE?p=5)

TODO

## 参考资料

1. [编译原理（哈工大）](https://www.bilibili.com/video/BV1zW411t7YE?p=1)，讲师陈鄞，哔哩哔哩