#+author: Liu Zhuan
#+date: 2020-12-13
#+TITLE: Org Mode 简明手册
#+STARTUP: content

* 介绍

** 激活

将如下代码添加到您的 Emacs 初始化文件，以便定义三个全局快捷键。

#+BEGIN_SRC elisp
(global-set-key (kbd "C-c l") 'org-store-link)
(global-set-key (kbd "C-c a") 'org-agenda)
(global-set-key (kbd "C-c c") 'org-capture)
#+END_SRC


* 文档结构

Org 是一种大纲视图。大纲视图会以层级结构表示文档。Org 使用命令 ~org-cycle~ 显示隐藏大纲层级，此命令与 TAB 键绑定。

** 标题

标题定义了大纲的树形结构。使用 ~*~ 指定标题。

注意如果标题名称等于 ~org-footnote-section~ 变量值，默认为 ~Footnotes~，那么该标题会被特殊处理。该标题的子树导出时会被忽略。

如果觉得星星太多，影响阅读，可以设置为 Org Indnet 模式。

#+BEGIN_SRC
M-x org-indent-mode RET
#+END_SRC

** 视图模式切换

大纲视图下可以隐藏部分内容。Org 使用 ~TAB~ 和 ~S-TAB~ 切换视图模式。

~TAB~ 键可以让当前子树的视图模式在 FOLDED, CHILDREN, SUBTREE 三个状态间循环展示。

~S-TAB~ 可以让全局视图状态在 OVERVIEW, CONTENTS 和 SHOW ALL 三个状态循环显示。

当 Emacs 初次访问某个 Org 文件，全局状态会被设为 OVERVIEW，此时仅显示顶级标题。这种默认行为可以通过变量 ~org-startup-folded~ 设定，
也可以针对单个文件，增加 ~STARTUP~ 关键字，将其设为 overview, content 或 show。比如：

#+BEGIN_SRC
#+STARTUP: content
#+END_SRC

** 移动

以下命令会在当前缓冲区的标题间跳转

| 快捷键  | 说明             |
|---------+------------------|
| C-c C-n | 下一个标题       |
| C-c C-p | 上一个标题       |
| C-c C-f | 下一个同级标题   |
| C-c C-b | 上一个同级标题   |
| C-c C-u | 返回上一层级标题 |

** 结构化编辑

| 快捷键  | 说明                                         |
|---------+----------------------------------------------|
| M-RET   | 插入同级标题、列表元素                       |
| M-S-RET | 插入同级的 TODO 条目标题                     |
| M-LEFT  | 将当前标题提升一级                           |
| M-Right | 将当前标题降低一级                           |
| M-UP    | 将当前子树上移                               |
| M-DOWN  | 将当前子树下移 org-metadown                  |
| C-c C-w | 将当前条目或子树移动到别的位置 org-refile    |
| C-x n s | 将缓冲区收缩到当前子树 org-narrow-to-subtree |
| C-x n w | 将缓冲区扩大到原始状态 widen                 |

** 稀疏树

Org 模式的一个重要特性是在大纲层级树中，为选中的信息构建*稀疏树*。无论整个文档如何折叠，选中的信息始终可见。

Org 有一些创建这种树的快捷键，都需要通过调度器（dispatcher）来获取。

| 快捷键  | 说明                                 |
|---------+--------------------------------------|
| C-c /   | 触发弹窗，选择稀疏树 org-sparse-tree |
| C-c / r | 使用正则表达式选择稀疏树             |

** 普通列表

Org 理解有序列表，无序列表和描述列表

- 无序列表的条目以 ~-~, ~+~ 或 ~*~ 开头
- 有序列表以 ~1.~ 或 ~1)~ 开头
- 描述列表使用 ~::~ 分隔名词和描述

列表支持以下命令：

| 命令      | 说明                                     |
|-----------+------------------------------------------|
| TAB       | 条目可以像标题层级一样被隐藏             |
| M-RET     | 加入同级条目，使用前缀命令，强制新增标题 |
| M-S-RET   | 加入新的选择框条目                       |
| M-S-UP    | 将当前条目及其子条目上移                 |
| M-S-DOWN  | 将当前条目及其子条目下移                 |
| M-LEFT    | 减少条目缩进量                           |
| M-RIGHT   | 增加条目缩进量                           |
| M-S-LEFT  | 减少条目及其子条目的缩进量               |
| M-S-RIGHT | 增加条目及其子条目的缩进量               |
| C-c C-c   | 如果条目有选择框，切换选择框的状态       |
| C-c -     | 切换整个列表的前缀标识符                 |


* Tables

Org 自带一个高效直观的表格编辑器。结合 Emacs Calc 包，还能实现电子表格类似的功能。

表格会在按下 TAB、RET 或 ~C-c C-c~ 时自动对齐，表格的缩进量由第一行决定。

如果要快速插入一个横线，可以使用命令 ~C-c RET~。

| Name  | Phone | Age |
|-------+-------+-----|
| Peter |  1234 |  17 |
| Anna  |  4321 |  25 |
|-------+-------+-----|

常见的命令行如下

** 创建和转换

| 快捷键 | 说明                   |
|--------+------------------------|
| C-c /  | 将活动区域转变为表格。 |

** 对齐和字段移动

| 快捷键  | 说明                                                     |
|---------+----------------------------------------------------------|
| C-c C-c | 重新对齐表格，光标位置保持不变                           |
| TAB     | 重新对齐表格，移动到下一个单元格，如果有必要，会创建新行 |
| S-TAB   | 重新对齐表格，移动到上一个单元格                         |
| RET     | 重新对齐表格，移动到下一行，如果有必要，会创建新行       |

** 行列编辑操作

| 快捷键          | 说明                                                           |
|-----------------+----------------------------------------------------------------|
| M-LEFT, M-RIGHT | 向左/向右移动当前列                                            |
| M-UP, M-DOWN    | 向上/向下移动当前行                                            |
| C-c -           | 在当前行下插入一条横线，如果加上前缀，可以在当前行上面新增横线 |
| C-c RET         | 在当前行下新增一行                                             |
| C-c ^           | 排序                                                           |
|-----------------+----------------------------------------------------------------|


* 超链接

Org 提供了像 HTML 一般的超链接，目标地址可以是文件内地址、外部文件、Usenet 文章、电子邮箱等等。

如果要编辑链接地址，可以将光标放到超链接上，然后执行 ~C-c C-l~ 命令(org-insert-link)。

** 内部链接

如果链接地址不像 URL，会被当作当前文件的内部链接。最常见的使用场景比如 =[[#my-custom-id]]= 将链接到 ~CUSTOM_ID~ 为 ~my-custom-id~ 的地方。

** 外部链接

外部链接同 URL 规范类似。

文件链接可以包含更多信息，可以直接跳转到指定的行。比如：

#+BEGIN_SRC 
file:~/code/main.c::255
#+END_SRC

** 处理链接

主要的函数是 ~org-store-link~ ，可以使用 ~M-x org-store-link~ 唤起。推荐将其绑定到一个全局快捷键，比如 ~C-c l~ 。

* References

1. [[https://orgmode.org/guide][Org Mode Compact Guide]]
